!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("leaflet")):"function"==typeof define&&define.amd?define(["leaflet"],t):(e.L=e.L||{},e.L.esri=t(e.L))}(this,function(e){"use strict";function t(e){var t="";e.f=e.f||"json";for(var r in e)if(e.hasOwnProperty(r)){var o,i=e[r],n=Object.prototype.toString.call(i);t.length&&(t+="&"),o="[object Array]"===n?"[object Object]"===Object.prototype.toString.call(i[0])?JSON.stringify(i):i.join(","):"[object Object]"===n?JSON.stringify(i):"[object Date]"===n?i.valueOf():i,t+=encodeURIComponent(r)+"="+encodeURIComponent(o)}return t}function r(t,r){var o=new window.XMLHttpRequest;return o.onerror=function(i){o.onreadystatechange=e.Util.falseFn,t.call(r,{error:{code:500,message:"XMLHttpRequest error"}},null)},o.onreadystatechange=function(){var i,n;if(4===o.readyState){try{i=JSON.parse(o.responseText)}catch(a){i=null,n={code:500,message:"Could not parse response as JSON. This could also be caused by a CORS or XMLHttpRequest error."}}!n&&i.error&&(n=i.error,i=null),o.onerror=e.Util.falseFn,t.call(r,n,i)}},o.ontimeout=function(){this.onerror()},o}function o(e,o,i,n){var a=r(i,n);return a.open("GET",e+"?"+t(o),!0),"undefined"!=typeof n&&null!==n&&"undefined"!=typeof n.options&&(a.timeout=n.options.timeout),a.send(null),a}function i(r,o,i,n){window._EsriLeafletCallbacks=window._EsriLeafletCallbacks||{};var a="c"+Z;o.callback="window._EsriLeafletCallbacks."+a,window._EsriLeafletCallbacks[a]=function(e){if(window._EsriLeafletCallbacks[a]!==!0){var t,r=Object.prototype.toString.call(e);"[object Object]"!==r&&"[object Array]"!==r&&(t={error:{code:500,message:"Expected array or object as JSONP response"}},e=null),!t&&e.error&&(t=e,e=null),i.call(n,t,e),window._EsriLeafletCallbacks[a]=!0}};var s=e.DomUtil.create("script",null,document.body);return s.type="text/javascript",s.src=r+"?"+t(o),s.id=a,Z++,{id:a,url:s.src,abort:function(){window._EsriLeafletCallbacks._callback[a]({code:0,message:"Request aborted."})}}}function n(e,t){for(var r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}function a(e){return n(e[0],e[e.length-1])||e.push(e[0]),e}function s(e){var t,r=0,o=0,i=e.length,n=e[o];for(o;i-1>o;o++)t=e[o+1],r+=(t[0]-n[0])*(t[1]+n[1]),n=t;return r>=0}function l(e,t,r,o){var i=(o[0]-r[0])*(e[1]-r[1])-(o[1]-r[1])*(e[0]-r[0]),n=(t[0]-e[0])*(e[1]-r[1])-(t[1]-e[1])*(e[0]-r[0]),a=(o[1]-r[1])*(t[0]-e[0])-(o[0]-r[0])*(t[1]-e[1]);if(0!==a){var s=i/a,l=n/a;if(s>=0&&1>=s&&l>=0&&1>=l)return!0}return!1}function c(e,t){for(var r=0;r<e.length-1;r++)for(var o=0;o<t.length-1;o++)if(l(e[r],e[r+1],t[o],t[o+1]))return!0;return!1}function u(e,t){for(var r=!1,o=-1,i=e.length,n=i-1;++o<i;n=o)(e[o][1]<=t[1]&&t[1]<e[n][1]||e[n][1]<=t[1]&&t[1]<e[o][1])&&t[0]<(e[n][0]-e[o][0])*(t[1]-e[o][1])/(e[n][1]-e[o][1])+e[o][0]&&(r=!r);return r}function p(e,t){var r=c(e,t),o=u(e,t[0]);return!(r||!o)}function m(e){for(var t,r,o,i=[],n=[],l=0;l<e.length;l++){var u=a(e[l].slice(0));if(!(u.length<4))if(s(u)){var m=[u];i.push(m)}else n.push(u)}for(var b=[];n.length;){o=n.pop();var f=!1;for(t=i.length-1;t>=0;t--)if(r=i[t][0],p(r,o)){i[t].push(o),f=!0;break}f||b.push(o)}for(;b.length;){o=b.pop();var d=!1;for(t=i.length-1;t>=0;t--)if(r=i[t][0],c(r,o)){i[t].push(o),d=!0;break}d||i.push([o.reverse()])}return 1===i.length?{type:"Polygon",coordinates:i[0]}:{type:"MultiPolygon",coordinates:i}}function b(e){var t=[],r=e.slice(0),o=a(r.shift().slice(0));if(o.length>=4){s(o)||o.reverse(),t.push(o);for(var i=0;i<r.length;i++){var n=a(r[i].slice(0));n.length>=4&&(s(n)&&n.reverse(),t.push(n))}}return t}function f(e){for(var t=[],r=0;r<e.length;r++)for(var o=b(e[r]),i=o.length-1;i>=0;i--){var n=o[i].slice(0);t.push(n)}return t}function d(e){var t={};for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t}function v(e,t){var r={};return"number"==typeof e.x&&"number"==typeof e.y&&(r.type="Point",r.coordinates=[e.x,e.y]),e.points&&(r.type="MultiPoint",r.coordinates=e.points.slice(0)),e.paths&&(1===e.paths.length?(r.type="LineString",r.coordinates=e.paths[0].slice(0)):(r.type="MultiLineString",r.coordinates=e.paths.slice(0))),e.rings&&(r=m(e.rings.slice(0))),(e.geometry||e.attributes)&&(r.type="Feature",r.geometry=e.geometry?v(e.geometry):null,r.properties=e.attributes?d(e.attributes):null,e.attributes&&(r.id=e.attributes[t]||e.attributes.OBJECTID||e.attributes.FID)),r}function g(e,t){t=t||"OBJECTID";var r,o={wkid:4326},i={};switch(e.type){case"Point":i.x=e.coordinates[0],i.y=e.coordinates[1],i.spatialReference=o;break;case"MultiPoint":i.points=e.coordinates.slice(0),i.spatialReference=o;break;case"LineString":i.paths=[e.coordinates.slice(0)],i.spatialReference=o;break;case"MultiLineString":i.paths=e.coordinates.slice(0),i.spatialReference=o;break;case"Polygon":i.rings=b(e.coordinates.slice(0)),i.spatialReference=o;break;case"MultiPolygon":i.rings=f(e.coordinates.slice(0)),i.spatialReference=o;break;case"Feature":e.geometry&&(i.geometry=g(e.geometry,t)),i.attributes=e.properties?d(e.properties):{},e.id&&(i.attributes[t]=e.id);break;case"FeatureCollection":for(i=[],r=0;r<e.features.length;r++)i.push(g(e.features[r],t));break;case"GeometryCollection":for(i=[],r=0;r<e.geometries.length;r++)i.push(g(e.geometries[r],t))}return i}function y(e,t){return g(e,t)}function h(e,t){return v(e,t)}function S(e){var t={};for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t}function _(t){var r=e.latLng(t.ymin,t.xmin),o=e.latLng(t.ymax,t.xmax);return e.latLngBounds(r,o)}function x(t){return t=e.latLngBounds(t),{xmin:t.getSouthWest().lng,ymin:t.getSouthWest().lat,xmax:t.getNorthEast().lng,ymax:t.getNorthEast().lat,spatialReference:{wkid:4326}}}function T(e,t){var r;if(t)r=t;else if(e.objectIdFieldName)r=e.objectIdFieldName;else if(e.fields){for(var o=0;o<=e.fields.length-1;o++)if("esriFieldTypeOID"===e.fields[o].type){r=e.fields[o].name;break}}else r="OBJECTID";var i={type:"FeatureCollection",features:[]},n=e.features||e.results;if(n.length)for(var a=n.length-1;a>=0;a--){var s=h(n[a],r);i.features.push(s)}return i}function A(t){return t=e.Util.trim(t),"/"!==t[t.length-1]&&(t+="/"),t}function L(e){return/\.arcgis\.com.*?FeatureServer/g.test(e)}function G(e){var t;switch(e){case"Point":t="esriGeometryPoint";break;case"MultiPoint":t="esriGeometryMultipoint";break;case"LineString":t="esriGeometryPolyline";break;case"MultiLineString":t="esriGeometryPolyline";break;case"Polygon":t="esriGeometryPolygon";break;case"MultiPolygon":t="esriGeometryPolygon"}return t}function I(){console&&console.warn&&console.warn.apply(console,arguments)}function w(t,r){i(t,{},e.Util.bind(function(t,o){if(!t){r._esriAttributions=[];for(var i=0;i<o.contributors.length;i++)for(var n=o.contributors[i],a=0;a<n.coverageAreas.length;a++){var s=n.coverageAreas[a],l=e.latLng(s.bbox[0],s.bbox[1]),c=e.latLng(s.bbox[2],s.bbox[3]);r._esriAttributions.push({attribution:n.attribution,score:s.score,bounds:e.latLngBounds(l,c),minZoom:s.zoomMin,maxZoom:s.zoomMax})}r._esriAttributions.sort(function(e,t){return t.score-e.score});var u={target:r};this._updateMapAttribution(u)}},this))}function M(t){var r=t.target,o=r._esriAttributions;if(r&&r.attributionControl&&o){for(var i="",n=r.getBounds(),a=e.latLngBounds(n.getSouthWest().wrap(),n.getNorthEast().wrap()),s=r.getZoom(),l=0;l<o.length;l++){var c=o[l],u=c.attribution;!i.match(u)&&c.bounds.intersects(a)&&s>=c.minZoom&&s<=c.maxZoom&&(i+=", "+u)}i=i.substr(2);var p=r.attributionControl._container.querySelector(".esri-attributions");p.innerHTML=i,p.style.maxWidth=O(r),r.fire("attributionupdated",{attribution:i})}}function O(e){return e.getSize().x-160+"px"}function P(e,t){return new B(e,t)}e="default"in e?e["default"]:e;var C=window.XMLHttpRequest&&"withCredentials"in new window.XMLHttpRequest,R=""===document.documentElement.style.pointerEvents,E={cors:C,pointerEvents:R},Z=0,k=E.cors?o:i;k.CORS=o,k.JSONP=i;var U={shallowClone:S,warn:I,cleanUrl:A,isArcgisOnline:L,geojsonTypeToArcGIS:G,responseToFeatureCollection:T,geojsonToArcGIS:y,arcgisToGeoJSON:h,boundsToExtent:x,extentToBounds:_,_getAttributionData:w,_updateMapAttribution:M,calcAttributionWidth:O},N="https:"!==window.location.protocol?"http:":"https:",B=e.TileLayer.extend({statics:{ATTRIBUTIONPREFIX:'<a href="http://leafletjs.com" title="A JS library for interactive maps">Leaflet</a>',TILES:{Streets:{urlTemplate:N+"//{s}.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,subdomains:["server","services"],attribution:"USGS, NOAA",attributionUrl:"https://static.arcgis.com/attribution/World_Street_Map"}},Topographic:{urlTemplate:N+"//{s}.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,subdomains:["server","services"],attribution:"USGS, NOAA",attributionUrl:"https://static.arcgis.com/attribution/World_Topo_Map"}},Oceans:{urlTemplate:N+"//{s}.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],attribution:"USGS, NOAA",attributionUrl:"https://static.arcgis.com/attribution/Ocean_Basemap"}},OceansLabels:{urlTemplate:N+"//{s}.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],pane:R?"esri-labels":"tilePane"}},NationalGeographic:{urlTemplate:N+"//{s}.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],attribution:"National Geographic, DeLorme, HERE, UNEP-WCMC, USGS, NASA, ESA, METI, NRCAN, GEBCO, NOAA, increment P Corp."}},DarkGray:{urlTemplate:N+"//{s}.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Base/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],attribution:"HERE, DeLorme, MapmyIndia, &copy; OpenStreetMap contributors"}},DarkGrayLabels:{urlTemplate:N+"//{s}.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Reference/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],pane:R?"esri-labels":"tilePane",attribution:""}},Gray:{urlTemplate:N+"//{s}.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],attribution:"HERE, DeLorme, MapmyIndia, &copy; OpenStreetMap contributors"}},GrayLabels:{urlTemplate:N+"//{s}.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Reference/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],pane:R?"esri-labels":"tilePane",attribution:""}},Imagery:{urlTemplate:N+"//{s}.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,subdomains:["server","services"],attribution:"DigitalGlobe, GeoEye, i-cubed, USDA, USGS, AEX, Getmapping, Aerogrid, IGN, IGP, swisstopo, and the GIS User Community"}},ImageryLabels:{urlTemplate:N+"//{s}.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,subdomains:["server","services"],pane:R?"esri-labels":"tilePane",attribution:""}},ImageryTransportation:{urlTemplate:N+"//{s}.arcgisonline.com/ArcGIS/rest/services/Reference/World_Transportation/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,subdomains:["server","services"],pane:R?"esri-labels":"tilePane"}},ShadedRelief:{urlTemplate:N+"//{s}.arcgisonline.com/ArcGIS/rest/services/World_Shaded_Relief/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:13,subdomains:["server","services"],attribution:"USGS"}},ShadedReliefLabels:{urlTemplate:N+"//{s}.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places_Alternate/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:12,subdomains:["server","services"],pane:R?"esri-labels":"tilePane",attribution:""}},Terrain:{urlTemplate:N+"//{s}.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:13,subdomains:["server","services"],attribution:"USGS, NOAA"}},TerrainLabels:{urlTemplate:N+"//{s}.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:13,subdomains:["server","services"],pane:R?"esri-labels":"tilePane",attribution:""}},USATopo:{urlTemplate:N+"//{s}.arcgisonline.com/ArcGIS/rest/services/USA_Topo_Maps/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:15,subdomains:["server","services"],attribution:"USGS, National Geographic Society, i-cubed"}}}},initialize:function(t,r){var o;if("object"==typeof t&&t.urlTemplate&&t.options)o=t;else{if("string"!=typeof t||!B.TILES[t])throw new Error('L.esri.BasemapLayer: Invalid parameter. Use one of "Streets", "Topographic", "Oceans", "OceansLabels", "NationalGeographic", "Gray", "GrayLabels", "DarkGray", "DarkGrayLabels", "Imagery", "ImageryLabels", "ImageryTransportation", "ShadedRelief", "ShadedReliefLabels", "Terrain", "TerrainLabels" or "USATopo"');o=B.TILES[t]}var i=e.Util.extend(o.options,r);e.Util.setOptions(this,i),this.options.token&&(o.urlTemplate+="?token="+this.options.token),e.TileLayer.prototype.initialize.call(this,o.urlTemplate,i)},onAdd:function(t){t._esriBasemapCount?t._esriBasemapCount+=1:t._esriBasemapCount=1,t.attributionControl&&t.attributionControl.setPrefix(B.ATTRIBUTIONPREFIX+' | Powered by <a href="https://www.esri.com">Esri</a>'),"esri-labels"===this.options.pane&&this._initPane(),this.options.attributionUrl&&U._getAttributionData(this.options.attributionUrl,t),t.on("moveend",U._updateMapAttribution),e.TileLayer.prototype.onAdd.call(this,t)},onRemove:function(t){t._esriBasemapCount-=1,t.attributionControl&&t._esriBasemapCount<1&&t.attributionControl.setPrefix(B.ATTRIBUTIONPREFIX),t.off("moveend",U._updateMapAttribution),e.TileLayer.prototype.onRemove.call(this,t)},_initPane:function(){if(!this._map.getPane(this.options.pane)){var e=this._map.createPane(this.options.pane);e.style.pointerEvents="none",e.style.zIndex=500}},getAttribution:function(){if(this.options.attribution)var e='<span class="esri-attributions" style="line-height:14px; vertical-align: -3px; text-overflow:ellipsis; white-space:nowrap; overflow:hidden; display:inline-block; max-width:'+U.calcAttributionWidth(this._map)+';">'+this.options.attribution+"</span>";return e}}),W={basemapLayer:P};return W});